---
- name: Add PHP Repository
  apt_repository: repo='ppa:ondrej/php5' state=present
  register: ppaphp

- name: Install PHP and PHP-FPM
  register: phpinstall
  when: ppaphp|success
  apt: pkg={{ item }} state=installed update_cache=true
  with_items:
   - php5-fpm
   - php5-cli
   - php5-pgsql
   - php5-mysql
   - php5-sqlite
   - php5-curl
   - php5-gd
   - php5-mcrypt
   - php5-memcached
   - php5-intl
  notify:
    - Start PHP-FPM

- name: Create and Set Permissions of Chroot Directory
  file: path=/var/www state=directory owner=www-data group=www-data

- name: Create and Set Permissions of Chroot Log Directory
  file: path=/var/www/log state=directory owner=www-data group=www-data

- name: Create and Set Permissions Chroot TMP Directory
  file: path=/var/www/tmp state=directory owner=www-data group=www-data

- name: Create and Set Permissions Chroot Session Directory
  file: path=/var/www/tmp/sessions state=directory owner=www-data group=www-data

- name: Add PHP-FPM PHP Configuration
  template: src=php.ini dest=/etc/php5/fpm/php.ini owner=root group=root
  notify:
    - Restart PHP-FPM

- name: Add Default Resource Pool
  when: phpinstall|success
  template: src=www.conf.j2 dest=/etc/php5/fpm/pool.d/www.conf owner=root group=root mode=644
  notify:
    - Restart PHP-FPM
