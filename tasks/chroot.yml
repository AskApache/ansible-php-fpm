---
- name: Create and Set Permissions of Chroot Directory
  file: path=/var/www state=directory owner=www-data group=www-data

- name: Create and Set Permissions of Chroot Log Directory
  file: path=/var/www/log state=directory owner=www-data group=www-data

- name: Create and Set Permissions Chroot TMP Directory
  file: path=/var/www/tmp state=directory owner=www-data group=www-data

- name: Create and Set Permissions Chroot Session Directory
  file: path=/var/www/tmp/sessions state=directory owner=www-data group=www-data

- name: Create and Set Permissions Chroot etc Directory
  file: path=/var/www/etc state=directory owner=www-data group=www-data

- name: Copy Localtime File to Chroot
  shell: cp /etc/localtime /var/www/etc/localtime

- name: Create Chroot /usr/share
  file: path=/var/www/usr/share/ state=directory owner=www-data group=www-data

- name: Copy Zoneinfo Directory to Chroot
  shell: cp -r /usr/share/zoneinfo /var/www/usr/share/zoneinfo

- name: Create Chroot /dev
  file: path=/var/www/dev state=directory owner=www-data group=www-data

# Reference: http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/

- name: Mknod /dev/null to Chroot
  shell: /bin/mknod -m 0444 /var/www/dev/null c 1 3
  ignore_errors: yes

- name: Mknod /dev/random to Chroot
  shell: /bin/mknod -m 0444 /var/www/dev/random c 1 8
  ignore_errors: yes

- name: Mknod /dev/urandom to Chroot
  shell: /bin/mknod -m 0444 /var/www/dev/urandom c 1 9
  ignore_errors: yes